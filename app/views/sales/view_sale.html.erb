<div class="cart">
    <h1 class="page-title">Carrinho de Compras</h1>

    <p>Selecione o tamanho, quantidade de cada imagem e clique em finalizar o pedido</p>

    <hr class='bigstroke'/>

    <input type="hidden" id="digital" value="<%= Price.where(price_type: 'digital').first.value %>">
    <input type="hidden" id="small" value="<%= Price.where(price_type: 'física_pequena').first.value %>">
    <input type="hidden" id="medium" value="<%= Price.where(price_type: 'física_média').first.value %>">
    <input type="hidden" id="big" value="<%= Price.where(price_type: 'física_grande').first.value %>">
    <% unless basket.nil? %>
    <table class="table table-striped">
        <tbody>
            <%= form_tag sale_finish_sale_path do %>
                <% basket.each do |key, value| %>
                    <tr class="basket-row">
                        <td class="image-crop">
                            <div class="crop">
                                <%= image_tag Photo.find(key).image_url(:crop_small).to_s, :class => 'img-rounded' %>
                            </div>
                        </td>
                        <td class="span2">
                            <div class="row-fluid">    
                                <div class="span6">                                    
                                    <%= number_field_tag "digital" + key.to_s, 1, :in => 0...10, :class => 'leform' %>
                                </div>
                                <div class="span6">
                                    <div class="size">                                        
                                        D (300x300)
                                    </div>
                                    <div class="price">                                        
                                        R$ <%= Price.where(price_type: 'digital').first.value %>
                                    </div>
                                </div> 
                            </div>
                        </td>
                        <td class="span2">
                            <div class="row-fluid">
                                <div class="span6">
                                    <%= number_field_tag "small" + key.to_s, 1, :in => 0...10, :class => 'leform' %>
                                </div>
                                <div class="span6">
                                    <div class="size">                                        
                                        P (300x300)
                                    </div>
                                    <div class="price">                                        
                                        R$ <%= Price.where(price_type: 'física_pequena').first.value %>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td class="span2">
                            <div class="row-fluid">
                                <div class="span6">                                    
                                    <%= number_field_tag "medium" + key.to_s, 1, :in => 0...10, :class => 'leform' %>
                                </div>
                                <div class="span6">
                                    <div class="size">                                        
                                        M (300x300)
                                    </div>
                                    <div class="price">                                        
                                        R$ <%= Price.where(price_type: 'física_média').first.value %>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td class="span2">                            
                            <div class="row-fluid">
                                <div class="span6 numberinput">
                                    <%= number_field_tag "big" + key.to_s, 1, :in => 0...10, :class => 'leform' %>
                                </div>
                                <div class="span6">
                                    <div class="textinput">                                    
                                        <div class="size">                                        
                                            G (300x300)
                                        </div>
                                        <div class="price">                                        
                                            R$ <%= Price.where(price_type: 'física_grande').first.value %>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td class="span2">
                            <p class='delete'>
                                <%= image_tag 'delete.png', :alt => "Excluir" %>
                            </p>
                        </td>
                    </tr>
                <% end %>
            <% end %>            
        </tbody>
    </table>
    <% end %>
    <div class="finish right">
        <h2 class="total"> R$<span id="total"></span> Total </h1>
        <div class="row-fluid">            

            <p class="desc">
                Ao clicar em finalizar pedido, você receberá as informações no email de como prosseguir a compra                
                <%= submit_tag "FINALIZAR PEDIDO", :class => 'btn btn-info btn-finish-sale large' %>
            </p>
        </div>
    </div>
</div>

<script type="text/javascript">
$(document).ready(function() {
    $('#container-right').hide();
    $('#content').removeClass('span9');
    // $('#content').addClass('full');
    $('#body').addClass('full');        

    var digital = $("#digital").val();
    var small = $("#small").val();
    var medium = $("#medium").val();
    var big = $("#big").val();


    var calculateTotal = function() {
        var total = 0;
        $("[name^='digital']").each(function() {
            total = total + (parseInt(this.value) * digital);
        });
        $("[name^='small']").each(function() {
            total = total + (parseInt(this.value) * small);
        });
        $("[name^='medium']").each(function() {
            total = total + (parseInt(this.value) * medium);
        });
        $("[name^='big']").each(function() {
            total = total + (parseInt(this.value) * big);
        });

        $("#total").text(total);
    }

    $("[name^='digital']").each(function() {
        $(this).change(function() {
            calculateTotal();
        });
    });
    $("[name^='small']").each(function() {
        $(this).change(function() {
            calculateTotal();
        });
    });
    $("[name^='medium']").each(function() {
        $(this).change(function() {
            calculateTotal();
        });
    });
    $("[name^='big']").each(function() {
        $(this).change(function() {
            calculateTotal();
        });
    });

    calculateTotal();
});
</script>